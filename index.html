<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bacon x Bukowski Image Generator</title>
  <style>
    body {
      font-family: monospace;
      background: #111;
      color: #eee;
      padding: 2rem;
    }
    button {
      margin-right: 1rem;
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      background: #444;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    #promptOutput {
      margin-top: 2rem;
      white-space: pre-wrap;
    }
    #imageOutput {
      margin-top: 2rem;
      max-width: 100%;
    }
  </style>
</head>
<body>
  <h1>Charcoal + Chalk – Bacon x Bukowski</h1>
  <button onclick="generatePrompt()">Generate Prompt</button>
  <button onclick="generateImage()">Generate Image</button>

  <div id="promptOutput"></div>
  <img id="imageOutput" src="" alt="Generated image will appear here" />

  <script>
    let currentPrompt = '';

    const scenes = [
      "a faded motel room with old postcards",
      "an alleyway under neon light drizzle",
      "a quiet bar corner at closing time",
      "a hallway lined with forgotten paintings",
      "a stairwell bathed in dusty amber light",
      "an old gas station lost in twilight",
      "a butcher's shop closed for decades",
      "a subway platform echoing old jazz",
      "a hotel mirror catching memories",
      "a rainy rooftop hiding stories"
    ];

    const emotions = [
      "melancholic defiance",
      "gentle resignation",
      "quiet introspection",
      "grimy nostalgia",
      "reflective detachment",
      "soft longing",
      "wilted pride",
      "fragile calm",
      "dizzy regret",
      "cynical warmth"
    ];

    const objects = [
      "a glowing cigarette",
      "an empty glass with lipstick marks",
      "a crumpled unsent letter",
      "an overflowing ashtray",
      "a typewriter mid-sentence",
      "a dim lightbulb hanging low",
      "a shadowy figure half-seen",
      "shoes left by the door",
      "a rat near an old newspaper",
      "a chalk outline fading on pavement"
    ];

    function generatePrompt() {
      const scene = scenes[Math.floor(Math.random() * scenes.length)];
      const emotion = emotions[Math.floor(Math.random() * emotions.length)];
      const object = objects[Math.floor(Math.random() * objects.length)];
      const score = Math.floor(Math.random() * 101);

      currentPrompt = `An abstract portrait in the expressive style of Francis Bacon, using charcoal and pastel chalk.\nScene: ${scene}.\nMood: ${emotion}.\nFocus: ${object}.\nBukowski Vibe Index: ${score}/100.\n\nVisual style should explore raw textures, moody lighting, and emotional contrast — using mostly grayscale with soft red, yellow, and purple hues for accent. Emphasize feeling over realism, evoking poetic inner conflict with rough, gestural marks.`;

      document.getElementById("promptOutput").innerText = currentPrompt;
      document.getElementById("imageOutput").src = '';
    }

    async function generateImage() {
      if (!currentPrompt) {
        alert("Generate a prompt first!");
        return;
      }

      const response = await fetch("/api/generate-image", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ prompt: currentPrompt })
      });

      const data = await response.json();
      if (data && data.url) {
        document.getElementById("imageOutput").src = data.url;
      } else {
        alert("Failed to generate image.");
        console.error(data);
      }
    }

    window.onload = generatePrompt;
  </script>
</body>
</html>
